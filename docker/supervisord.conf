[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700
chown=odin:odin

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisord]
nodaemon=true
user=odin
logfile=/data/supervisord.log
logfile_maxbytes=10MB
logfile_backups=3
pidfile=/var/run/supervisord.pid

[program:backend]
command=python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 --workers 1
directory=/app/backend
autostart=true
autorestart=true
startretries=5
startsecs=5
stdout_logfile=/data/backend.log
stdout_logfile_maxbytes=10MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=10

[program:mqtt_monitor]
command=python3 mqtt_monitor.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=5
startsecs=0
stdout_logfile=/data/mqtt_monitor.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=20

[program:moonraker_monitor]
command=python3 moonraker_monitor.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=5
startsecs=0
stdout_logfile=/data/moonraker_monitor.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=20

[program:go2rtc]
command=/usr/local/bin/go2rtc -config /app/go2rtc/go2rtc.yaml
autostart=true
autorestart=true
startretries=3
startsecs=3
stdout_logfile=/data/go2rtc.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
priority=30

[program:prusalink_monitor]
command=python3 prusalink_monitor.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=5
startsecs=0
stdout_logfile=/data/prusalink_monitor.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=25

[program:elegoo_monitor]
command=python3 elegoo_monitor.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=5
startsecs=0
stdout_logfile=/data/elegoo_monitor.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=26

[program:vision_monitor]
command=python3 vision_monitor.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=3
startsecs=1
stdout_logfile=/data/vision_monitor.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=35

[program:timelapse_capture]
command=python3 timelapse_capture.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=5
startsecs=0
stdout_logfile=/data/timelapse_capture.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=36

[program:report_runner]
command=python3 report_runner.py
directory=/app/backend
autostart=true
autorestart=unexpected
startretries=5
startsecs=0
stdout_logfile=/data/report_runner.log
stdout_logfile_maxbytes=5MB
redirect_stderr=true
environment=PYTHONUNBUFFERED="1"
priority=37
